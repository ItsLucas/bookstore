<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="/static/js/validate.js"></script>
    <title>Bookstore Customer Portal</title>
    <title>Foodie Customer Portal</title>
    <link href="https://cdn.bootcss.com/font-awesome/5.13.0/css/all.css" rel="stylesheet">
    <link href="/static/styles/style.css" rel="stylesheet">
    <script src="/static/js/PlaceOrder.js"></script>
    <script src="/static/js/DeleteCart.js"></script>
</head>

<body>
<header>
    <div class="content-wrapper">
        <h1>Bookstore</h1>
        <nav>
            <a href="/index.html">Home</a>
            <a href="/product.html">Products</a>
        </nav>
        <div class="link-icons">
            <a href="vip.html">
                <p id="username"></p></a>
                <a href="cart.html">
                    <i class="fas fa-shopping-cart"></i> <span>0</span>
                </a>
        </div>
    </div>
    <script>
        validate("https://itslucas.me/users/current", initUsername);

        function initUsername(data) {
            if (data) document.getElementById("username").innerHTML = data;
        }
    </script>
</header>
<main>
    <div class="cart content-wrapper">
        <h1>Shopping Cart</h1>
        <div>
            <table>
                <thead>
                <tr>
                    <td colspan="2">Product</td>
                    <td>Price</td>
                    <td>Quantity</td>
                    <td>Total</td>
                </tr>
                </thead>
                <tbody id="cartItems">
                </tbody>
            </table>
            <div class="subtotal" id="subtotal">
                <span class="text">Discount</span>
                <span class="price">&dollar;0</span>
                <span class="text">Subtotal</span>
                <span class="price" id="subprice"></span>
            </div>
            <div class="buttons">

                <input name="placeorder" onclick="PlaceOrder()" type="submit" value="Place Order"/>

            </div>
        </div>
    </div>
</main>
<footer>
    <div class="content-wrapper">
        <p>&copy; 2020, Bookstore Ltd.</p>
    </div>
</footer>


<script>
    var cartItems;
    validate("https://itslucas.me/api/cart", init);

    function init(data) {

        cartItems = JSON.parse(data);
        console.log(cartItems);
        var totalPrice = 0;
        var tbody = document.getElementById("cartItems");
        cartItems.forEach(function (cartItem) {
            var tr = document.createElement("tr");
            var td = document.createElement("td");
            td.className = "img";
            var a = document.createElement("a");
            a.href = "/productdetail" + cartItem.book.id;
            var img = document.createElement("img");
            img.src = "/static/imgs/" + cartItem.book.id + ".jpg";
            img.width = "50";
            img.height = "50";
            a.appendChild(img);
            td.appendChild(a);
            tr.appendChild(td);

            var td = document.createElement("td");
            var a = document.createElement("a");
            a.href = "/productdetail.html?id=" + cartItem.book.id;
            a.innerHTML = cartItem.book.title;
            var input = document.createElement("input");
            input.type = "submit";
            input.value = "Delete from Cart";
            input.id = cartItem.book.id;
            input.onclick = DeleteCart;
            td.appendChild(input);
            td.appendChild(a);
            tr.appendChild(td);

            var td = document.createElement("td");
            td.className = "price";
            td.innerHTML = cartItem.book.listPrice + "USD";
            totalPrice += cartItem.book.listPrice;
            tr.appendChild(td);

            var td = document.createElement("td");
            td.className = "quantity";
            var input = document.createElement("input");
            input.type = "number";
            input.name = "quantity-F0019";
            input.value = "1";
            input.placeholder = "Quantity";
            td.appendChild(input);
            tr.appendChild(td);

            tbody.appendChild(tr);
        })

        var subprice = document.getElementById("subprice");
        subprice.innerHTML = "$" + totalPrice;
    }
</script>
</body>

</html>